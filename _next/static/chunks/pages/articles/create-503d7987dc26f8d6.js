(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[616],{5028:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/articles/create",function(){return a(7257)}])},7257:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>b});var r=a(7876),l=a(3276),s=a(2727),n=a(7660),o=a(9099),i=a(4232),d=a(2009),c=a(5226),u=a(4587),m=a.n(u);function b(){let[e,t]=(0,l.hD)(s.j2),a=(0,n.h)(null!=e?e:null),u=(0,o.useRouter)(),{id:b}=u.query,[x,g]=(0,i.useState)(""),[h,f]=(0,i.useState)(""),[y,p]=(0,i.useState)(!1),[v,j]=(0,i.useState)(null),[k,N]=(0,i.useState)(void 0),[w,_]=(0,i.useState)(!1),C="".concat("/my-homepage","/articledefalt.png"),S=async t=>{t.preventDefault();try{let t=(0,d.aU)(s.yA),a=k;if(v||a||(a=C),v){let e=(0,c.KR)(s.IG,"articles/".concat(Date.now(),"_").concat(v.name));await (0,c.D)(e,v),a=await (0,c.qk)(e)}if(b){let e={title:x,body:h,updatedAt:(0,d.O5)(),isDraft:y};void 0!==a&&(e.imageUrl=a),await (0,d.mZ)((0,d.H9)(t,"articles",b),e)}else{let r={title:x,body:h,createdAt:(0,d.O5)(),updatedAt:(0,d.O5)(),authorId:null==e?void 0:e.uid,tags:[],isDraft:y};void 0!==a&&(r.imageUrl=a),await (0,d.gS)((0,d.rJ)(t,"articles"),r)}_(!0)}catch(e){alert("保存時にエラーが発生しました: "+(e instanceof Error?e.message:String(e)))}};return((0,i.useEffect)(()=>{if(b){let e=(0,d.aU)(s.yA);(0,d.x7)((0,d.H9)(e,"articles",b)).then(e=>{if(e.exists()){let t=e.data();g(t.title||""),f(t.body||""),p(t.isDraft||!1),N(t.imageUrl||void 0)}})}},[b]),t||null===a)?(0,r.jsx)("div",{children:"Loading..."}):"admin"!==a?(0,r.jsx)("div",{className:"text-center text-red-500 py-10",children:"権限がありません"}):(0,r.jsx)("main",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"container w-full max-w-2xl rounded-3xl shadow-2xl p-8 md:p-12 flex flex-col items-center gap-8 border border-blue-100 dark:border-gray-700 backdrop-blur",style:{width:"80vw",background:"var(--card-bg)"},children:[(0,r.jsxs)("h2",{className:"text-2xl sm:text-3xl font-bold mb-6 text-center",style:{color:"var(--primary)"},children:[b?"edit":"create","（admin）"]}),(0,r.jsxs)("form",{onSubmit:S,className:"space-y-6 w-full",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--foreground)"},children:"title"}),(0,r.jsx)("input",{value:x,onChange:e=>g(e.target.value),placeholder:"title",required:!0,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-400 dark:bg-gray-900 dark:text-gray-100 transition"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--foreground)"},children:"body"}),(0,r.jsx)("textarea",{value:h,onChange:e=>f(e.target.value),placeholder:"body",required:!0,rows:8,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-400 dark:bg-gray-900 dark:text-gray-100 transition resize-y"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:y,onChange:e=>p(e.target.checked),id:"isDraft",className:"accent-blue-600"}),(0,r.jsx)("label",{htmlFor:"isDraft",className:"text-sm select-none",style:{color:"var(--foreground)"},children:"draft"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--foreground)"},children:"image upload"}),(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{e.target.files&&e.target.files[0]&&(j(e.target.files[0]),N(URL.createObjectURL(e.target.files[0])))},className:"block"}),(k||!v&&!k)&&(0,r.jsxs)("div",{className:"mt-3 flex flex-col items-center gap-2",children:[(0,r.jsx)(m(),{src:k||C,alt:"image",width:320,height:180,className:"rounded object-cover border",style:{maxWidth:320,height:"auto"}}),k&&k!==C&&(0,r.jsx)("button",{type:"button",onClick:()=>{j(null),N(void 0)},className:"mt-1 px-3 py-1 text-xs bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-100 rounded transition",disabled:w,children:"cancel"})]})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)("button",{type:"submit",className:"button button-blue font-semibold px-6 py-2 rounded shadow transition-colors duration-150",disabled:w,children:b?"update":"create"}),(0,r.jsx)("button",{type:"button",onClick:()=>{g(""),f(""),p(!1),j(null),N(void 0)},className:"button button-gray font-semibold px-6 py-2 rounded shadow transition-colors duration-150",disabled:w,children:"reset"})]})]}),w&&(0,r.jsx)("div",{className:"flex justify-center mt-8",children:(0,r.jsx)("button",{type:"button",className:"button button-blue font-semibold px-8 py-3 rounded shadow transition-colors duration-150",onClick:()=>u.push("/articles"),children:"complete"})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[587,276,636,593,792],()=>t(5028)),_N_E=e.O()}]);