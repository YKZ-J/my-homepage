(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[616],{5028:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/articles/create",function(){return a(7257)}])},7257:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var s=a(7876),l=a(3276),r=a(2727),i=a(7660),n=a(9099),o=a(4232),c=a(2009),d=a(5226),u=a(4587),x=a.n(u);function m(){let[e,t]=(0,l.hD)(r.j2),a=(0,i.h)(null!=e?e:null),u=(0,n.useRouter)(),{id:m}=u.query,[b,h]=(0,o.useState)(""),[g,f]=(0,o.useState)(""),[p,y]=(0,o.useState)(!1),[j,v]=(0,o.useState)(null),[N,w]=(0,o.useState)(void 0),[k,_]=(0,o.useState)(!1),C=async t=>{t.preventDefault();try{let t=(0,c.aU)(r.yA),a=N;if(j){let e=(0,d.KR)(r.IG,"articles/".concat(Date.now(),"_").concat(j.name));await (0,d.D)(e,j),a=await (0,d.qk)(e)}if(m){let e={title:b,body:g,updatedAt:(0,c.O5)(),isDraft:p};void 0!==a&&(e.imageUrl=a),await (0,c.mZ)((0,c.H9)(t,"articles",m),e)}else{let s={title:b,body:g,createdAt:(0,c.O5)(),updatedAt:(0,c.O5)(),authorId:null==e?void 0:e.uid,tags:[],isDraft:p};void 0!==a&&(s.imageUrl=a),await (0,c.gS)((0,c.rJ)(t,"articles"),s)}_(!0)}catch(e){alert("保存時にエラーが発生しました: "+(e instanceof Error?e.message:String(e)))}};return((0,o.useEffect)(()=>{if(m){let e=(0,c.aU)(r.yA);(0,c.x7)((0,c.H9)(e,"articles",m)).then(e=>{if(e.exists()){let t=e.data();h(t.title||""),f(t.body||""),y(t.isDraft||!1),w(t.imageUrl||void 0)}})}},[m]),t||null===a)?(0,s.jsx)("div",{children:"Loading..."}):"admin"!==a?(0,s.jsx)("div",{className:"text-center text-red-500 py-10",children:"権限がありません"}):(0,s.jsxs)("div",{className:"max-w-xl mx-auto px-4 py-8 bg-white rounded-lg shadow-md mt-6 mb-10",children:[(0,s.jsxs)("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-800 mb-6 text-center",children:[m?"記事編集":"記事作成","（管理者専用）"]}),(0,s.jsxs)("form",{onSubmit:C,className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"タイトル"}),(0,s.jsx)("input",{value:b,onChange:e=>h(e.target.value),placeholder:"タイトル",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-400 transition"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"本文"}),(0,s.jsx)("textarea",{value:g,onChange:e=>f(e.target.value),placeholder:"本文",required:!0,rows:8,className:"w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-400 transition resize-y"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:p,onChange:e=>y(e.target.checked),id:"isDraft",className:"accent-blue-600"}),(0,s.jsx)("label",{htmlFor:"isDraft",className:"text-sm text-gray-700 select-none",children:"下書きとして保存"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"画像アップロード"}),(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{e.target.files&&e.target.files[0]&&(v(e.target.files[0]),w(URL.createObjectURL(e.target.files[0])))},className:"block"}),N&&(0,s.jsxs)("div",{className:"mt-3 flex flex-col items-center gap-2",children:[(0,s.jsx)(x(),{src:N,alt:"記事画像",width:320,height:180,className:"rounded object-cover border",style:{maxWidth:320,height:"auto"}}),(0,s.jsx)("button",{type:"button",onClick:()=>{v(null),w(void 0)},className:"mt-1 px-3 py-1 text-xs bg-gray-200 hover:bg-gray-300 text-gray-700 rounded transition",disabled:k,children:"画像をキャンセル"})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-black font-semibold px-6 py-2 rounded shadow transition-colors duration-150",disabled:k,children:m?"更新":"作成"}),(0,s.jsx)("button",{type:"button",onClick:()=>{h(""),f(""),y(!1),v(null),w(void 0)},className:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-6 py-2 rounded shadow transition-colors duration-150",disabled:k,children:"リセット"})]})]}),k&&(0,s.jsx)("div",{className:"flex justify-center mt-8",children:(0,s.jsx)("button",{type:"button",className:"bg-green-600 hover:bg-green-700 text-black font-semibold px-8 py-3 rounded shadow transition-colors duration-150",onClick:()=>u.push("/articles"),children:"作成完了"})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[587,276,636,593,792],()=>t(5028)),_N_E=e.O()}]);