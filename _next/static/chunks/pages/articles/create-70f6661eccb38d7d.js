(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[616],{5028:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/articles/create",function(){return a(7257)}])},7257:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>x});var r=a(7876),s=a(3276),l=a(2727),i=a(7660),d=a(9099),n=a(4232),o=a(2009),c=a(5226),u=a(4587),g=a.n(u);function x(){let[e,t]=(0,s.hD)(l.j2),a=(0,i.h)(null!=e?e:null),u=(0,d.useRouter)(),{id:x}=u.query,[b,m]=(0,n.useState)(""),[h,y]=(0,n.useState)(""),[f,p]=(0,n.useState)(!1),[k,v]=(0,n.useState)(null),[j,w]=(0,n.useState)(void 0),[N,_]=(0,n.useState)(!1),C=async t=>{t.preventDefault();try{let t=(0,o.aU)(l.yA),a=j;if(k||a||(a="/articledefalt.png"),k){let e=(0,c.KR)(l.IG,"articles/".concat(Date.now(),"_").concat(k.name));await (0,c.D)(e,k),a=await (0,c.qk)(e)}if(x){let e={title:b,body:h,updatedAt:(0,o.O5)(),isDraft:f};void 0!==a&&(e.imageUrl=a),await (0,o.mZ)((0,o.H9)(t,"articles",x),e)}else{let r={title:b,body:h,createdAt:(0,o.O5)(),updatedAt:(0,o.O5)(),authorId:null==e?void 0:e.uid,tags:[],isDraft:f};void 0!==a&&(r.imageUrl=a),await (0,o.gS)((0,o.rJ)(t,"articles"),r)}_(!0)}catch(e){alert("保存時にエラーが発生しました: "+(e instanceof Error?e.message:String(e)))}};return((0,n.useEffect)(()=>{if(x){let e=(0,o.aU)(l.yA);(0,o.x7)((0,o.H9)(e,"articles",x)).then(e=>{if(e.exists()){let t=e.data();m(t.title||""),y(t.body||""),p(t.isDraft||!1),w(t.imageUrl||void 0)}})}},[x]),t||null===a)?(0,r.jsx)("div",{children:"Loading..."}):"admin"!==a?(0,r.jsx)("div",{className:"text-center text-red-500 py-10",children:"権限がありません"}):(0,r.jsx)("main",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-blue-100 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:(0,r.jsxs)("div",{className:"container w-full max-w-2xl bg-white/90 dark:bg-gray-800/90 rounded-3xl shadow-2xl p-8 md:p-12 flex flex-col items-center gap-8 border border-blue-100 dark:border-gray-700 backdrop-blur",style:{width:"80vw"},children:[(0,r.jsxs)("h2",{className:"text-2xl sm:text-3xl font-bold text-blue-900 dark:text-blue-200 mb-6 text-center",children:[x?"記事編集":"記事作成","（管理者専用）"]}),(0,r.jsxs)("form",{onSubmit:C,className:"space-y-6 w-full",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"タイトル"}),(0,r.jsx)("input",{value:b,onChange:e=>m(e.target.value),placeholder:"タイトル",required:!0,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-400 dark:bg-gray-900 dark:text-gray-100 transition"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"本文"}),(0,r.jsx)("textarea",{value:h,onChange:e=>y(e.target.value),placeholder:"本文",required:!0,rows:8,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-400 dark:bg-gray-900 dark:text-gray-100 transition resize-y"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:f,onChange:e=>p(e.target.checked),id:"isDraft",className:"accent-blue-600"}),(0,r.jsx)("label",{htmlFor:"isDraft",className:"text-sm text-gray-700 dark:text-gray-200 select-none",children:"下書きとして保存"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"画像アップロード"}),(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{e.target.files&&e.target.files[0]&&(v(e.target.files[0]),w(URL.createObjectURL(e.target.files[0])))},className:"block"}),j&&(0,r.jsxs)("div",{className:"mt-3 flex flex-col items-center gap-2",children:[(0,r.jsx)(g(),{src:j,alt:"記事画像",width:320,height:180,className:"rounded object-cover border",style:{maxWidth:320,height:"auto"}}),(0,r.jsx)("button",{type:"button",onClick:()=>{v(null),w(void 0)},className:"mt-1 px-3 py-1 text-xs bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-100 rounded transition",disabled:N,children:"画像をキャンセル"})]})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded shadow transition-colors duration-150",disabled:N,children:x?"更新":"作成"}),(0,r.jsx)("button",{type:"button",onClick:()=>{m(""),y(""),p(!1),v(null),w(void 0)},className:"bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-100 font-semibold px-6 py-2 rounded shadow transition-colors duration-150",disabled:N,children:"リセット"})]})]}),N&&(0,r.jsx)("div",{className:"flex justify-center mt-8",children:(0,r.jsx)("button",{type:"button",className:"bg-green-600 hover:bg-green-700 text-white font-semibold px-8 py-3 rounded shadow transition-colors duration-150",onClick:()=>u.push("/articles"),children:"作成完了"})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[587,276,636,593,792],()=>t(5028)),_N_E=e.O()}]);